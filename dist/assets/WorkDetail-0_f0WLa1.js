import{_ as me}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                   *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                 *//* empty css                  *//* empty css               */import{V as M,u as ve,r as m,J as pe,o as fe,C as N,D as he,b as n,x as c,d as l,g as r,w as u,G as ke,i as ye,t as i,E as ge,F as k,B as y,K as we,e as be,l as Ce,j as d,h as p,v as w,a as Ie,T as Te,A as a,M as Be,N as Le,q as Ne,U as C}from"./index-COpeM2_A.js";import{a as Ee,b as je,c as De,d as Ve}from"./work-CbuoV90x.js";import{a as $e,g as xe,b as Se}from"./collection-MFINAby5.js";function We(b,f){return M.get(`/social/achievements/${b}/comments`,{params:f})}function Re(b){return M.post("/social/comments",b)}function Ue(b){return M.post(`/social/comments/${b}/likes`)}const ze={class:"work-detail-page page-container"},Ae={key:0,class:"work-info card"},Me={class:"work-header"},Oe={class:"work-actions"},Ye={class:"work-title"},Fe={class:"work-meta"},Je={class:"meta-item"},qe={class:"authors"},Ke={key:0},Ge={key:1},He={key:0,class:"meta-item"},Pe={key:1,class:"meta-item"},Qe={class:"meta-item cited"},Xe={key:0,class:"publish-info"},Ze={class:"info-grid"},et={key:0,class:"info-item"},tt={class:"value"},st={key:1,class:"info-item"},at={class:"value"},ot={key:2,class:"info-item"},lt={class:"value"},nt={key:3,class:"info-item"},it=["href"],rt={key:1,class:"work-abstract"},ut={key:2,class:"work-keywords"},ct={class:"keywords-list"},dt={key:3,class:"work-concepts"},_t={class:"concepts-list"},mt={key:4,class:"work-institutions"},vt={class:"institutions-list"},pt={key:1,class:"work-references card"},ft={class:"ref-list"},ht={class:"ref-meta"},kt={class:"ref-list"},yt={class:"ref-meta"},gt={class:"ref-list"},wt={class:"ref-meta"},bt={key:2,class:"work-comments card"},Ct={class:"section-title"},It={key:0,class:"comment-form"},Tt={key:1,class:"login-tip"},Bt={class:"comments-list"},Lt={class:"comment-content"},Nt={class:"comment-header"},Et={class:"user-name"},jt={class:"comment-time"},Dt={class:"comment-text"},Vt={class:"comment-actions"},$t={__name:"WorkDetail",setup(b){const f=Ie(),E=ve(),S=m(!1),s=m(null),W=m("references"),v=m(!1),j=m([]),D=m([]),V=m([]),R=m(!1),U=m([]),O=m(0),I=m(""),z=m(!1),G=async()=>{S.value=!0;try{const o=await Ee(f.params.id);s.value=o.data,E.isLoggedIn&&$e({workId:s.value.workId,title:s.value.title,publisher:s.value.journal,publishTime:s.value.publishTime}).catch(()=>{})}catch(o){console.error("获取著作信息失败",o)}finally{S.value=!1}},Y=async()=>{var o;v.value=!0;try{const e=await je(f.params.id);j.value=((o=e.data)==null?void 0:o.list)||[]}catch(e){console.error("获取参考文献失败",e)}finally{v.value=!1}},H=async()=>{var o;v.value=!0;try{const e=await Ve(f.params.id);D.value=((o=e.data)==null?void 0:o.list)||[]}catch(e){console.error("获取被引文献失败",e)}finally{v.value=!1}},P=async()=>{var o;v.value=!0;try{const e=await De(f.params.id);V.value=((o=e.data)==null?void 0:o.list)||[]}catch(e){console.error("获取相关著作失败",e)}finally{v.value=!1}},F=async()=>{var o,e;R.value=!0;try{const _=await We(f.params.id,{page:1,size:20});U.value=((o=_.data)==null?void 0:o.list)||[],O.value=((e=_.data)==null?void 0:e.total)||0}catch(_){console.error("获取评论失败",_)}finally{R.value=!1}},Q=async()=>{if(!E.isLoggedIn){C.warning("请先登录");return}try{const e=(await xe()).data||[];if(!e.length){C.info("请先创建收藏夹");return}await Se({fid:e[0].fid,achievementId:s.value.workId,title:s.value.title,authors:s.value.authorNames,journal:s.value.journal,date:s.value.publishTime}),C.success("收藏成功")}catch(o){console.error("收藏失败",o)}},X=async()=>{if(!I.value.trim()){C.warning("请输入评论内容");return}z.value=!0;try{await Re({achievementId:f.params.id,content:I.value.trim()}),C.success("评论发表成功"),I.value="",F()}catch(o){console.error("发表评论失败",o)}finally{z.value=!1}},Z=async o=>{if(!E.isLoggedIn){C.warning("请先登录");return}try{await Ue(o.commentId),o.likes=(o.likes||0)+1}catch(e){console.error("点赞失败",e)}},ee=o=>({paper:"论文",book:"书籍",article:"文章",conference:"会议","journal-article":"期刊论文"})[o]||o||"论文",T=o=>o?Te(o).format("YYYY-MM-DD"):"未知",te=o=>{if(!o)return[];if(typeof o=="string"){let e=o;try{if(e=JSON.parse(o),typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e))return e.map(_=>_.replace(/^["']|["']$/g,"").trim()).filter(Boolean)}catch{}return e.toString().split(/[;；,，]/).map(_=>_.trim()).filter(Boolean)}return o};return pe(W,o=>{switch(o){case"references":j.value.length||Y();break;case"citedBy":D.value.length||H();break;case"related":V.value.length||P();break}}),fe(()=>{G(),Y(),F()}),(o,e)=>{var J,q,K;const _=ke,se=p("Star"),h=ge,$=ye,ae=p("User"),g=p("router-link"),oe=p("Notebook"),le=p("Calendar"),ne=p("DataLine"),ie=p("OfficeBuilding"),x=Le,A=Be,re=we,ue=Ce,ce=Ne,de=p("CaretTop"),_e=p("ChatLineRound"),B=he;return N((a(),n("div",ze,[s.value?(a(),n("div",Ae,[l("div",Me,[r(_,{type:"primary",size:"large"},{default:u(()=>[d(i(ee(s.value.type)),1)]),_:1}),l("div",Oe,[r($,{onClick:Q},{default:u(()=>[r(h,null,{default:u(()=>[r(se)]),_:1}),e[2]||(e[2]=d(" 收藏 ",-1))]),_:1})])]),l("h1",Ye,i(s.value.title),1),l("div",Fe,[l("div",Je,[r(h,null,{default:u(()=>[r(ae)]),_:1}),l("span",qe,[(J=s.value.authors)!=null&&J.length?(a(!0),n(k,{key:0},y(s.value.authors,(t,L)=>(a(),n("span",{key:t.id},[r(g,{to:`/authors/${t.id}`},{default:u(()=>[d(i(t.name),1)]),_:2},1032,["to"]),L<s.value.authors.length-1?(a(),n("span",Ke,", ")):c("",!0)]))),128)):(a(),n("span",Ge,i(s.value.authorNames||"未知作者"),1))])]),s.value.journal?(a(),n("div",He,[r(h,null,{default:u(()=>[r(oe)]),_:1}),l("span",null,i(s.value.journal),1)])):c("",!0),s.value.publishTime?(a(),n("div",Pe,[r(h,null,{default:u(()=>[r(le)]),_:1}),l("span",null,i(T(s.value.publishTime)),1)])):c("",!0),l("div",Qe,[r(h,null,{default:u(()=>[r(ne)]),_:1}),l("span",null,i(s.value.cited||0)+" 次引用",1)])]),s.value.volume||s.value.issue||s.value.pages||s.value.doi?(a(),n("div",Xe,[l("div",Ze,[s.value.volume?(a(),n("div",et,[e[3]||(e[3]=l("span",{class:"label"},"卷号：",-1)),l("span",tt,i(s.value.volume),1)])):c("",!0),s.value.issue?(a(),n("div",st,[e[4]||(e[4]=l("span",{class:"label"},"期号：",-1)),l("span",at,i(s.value.issue),1)])):c("",!0),s.value.pages?(a(),n("div",ot,[e[5]||(e[5]=l("span",{class:"label"},"页码：",-1)),l("span",lt,i(s.value.pages),1)])):c("",!0),s.value.doi?(a(),n("div",nt,[e[6]||(e[6]=l("span",{class:"label"},"DOI：",-1)),l("a",{href:`https://doi.org/${s.value.doi}`,target:"_blank",class:"value link"},i(s.value.doi),9,it)])):c("",!0)])])):c("",!0),s.value.abstract?(a(),n("div",rt,[e[7]||(e[7]=l("h3",null,"摘要",-1)),l("p",null,i(s.value.abstract),1)])):c("",!0),s.value.keywords?(a(),n("div",ut,[e[8]||(e[8]=l("h3",null,"关键词",-1)),l("div",ct,[(a(!0),n(k,null,y(te(s.value.keywords),t=>(a(),w(_,{key:t},{default:u(()=>[d(i(t),1)]),_:2},1024))),128))])])):c("",!0),(q=s.value.concepts)!=null&&q.length?(a(),n("div",dt,[e[9]||(e[9]=l("h3",null,"相关概念",-1)),l("div",_t,[(a(!0),n(k,null,y(s.value.concepts,t=>(a(),w(g,{key:t.id,to:`/concepts/${t.id}`,class:"concept-tag"},{default:u(()=>[d(i(t.name),1)]),_:2},1032,["to"]))),128))])])):c("",!0),(K=s.value.institutions)!=null&&K.length?(a(),n("div",mt,[e[10]||(e[10]=l("h3",null,"相关机构",-1)),l("div",vt,[(a(!0),n(k,null,y(s.value.institutions,t=>(a(),w(g,{key:t.id,to:`/institutions/${t.id}`,class:"institution-tag"},{default:u(()=>[r(h,null,{default:u(()=>[r(ie)]),_:1}),d(" "+i(t.name),1)]),_:2},1032,["to"]))),128))])])):c("",!0)])):c("",!0),s.value?(a(),n("div",pt,[r(re,{modelValue:W.value,"onUpdate:modelValue":e[0]||(e[0]=t=>W.value=t)},{default:u(()=>[r(A,{label:"参考文献",name:"references"},{default:u(()=>[N((a(),n("div",ft,[j.value.length?(a(!0),n(k,{key:0},y(j.value,t=>(a(),n("div",{class:"ref-item",key:t.workId},[r(g,{to:`/works/${t.workId}`,class:"ref-title"},{default:u(()=>[d(i(t.title),1)]),_:2},1032,["to"]),l("p",ht,i(t.authors)+" · "+i(t.journal)+" · "+i(T(t.publishTime)),1)]))),128)):(a(),w(x,{key:1,description:"暂无参考文献"}))])),[[B,v.value]])]),_:1}),r(A,{label:"被引用",name:"citedBy"},{default:u(()=>[N((a(),n("div",kt,[D.value.length?(a(!0),n(k,{key:0},y(D.value,t=>(a(),n("div",{class:"ref-item",key:t.workId},[r(g,{to:`/works/${t.workId}`,class:"ref-title"},{default:u(()=>[d(i(t.title),1)]),_:2},1032,["to"]),l("p",yt,i(t.authors)+" · "+i(t.journal)+" · "+i(T(t.publishTime)),1)]))),128)):(a(),w(x,{key:1,description:"暂无被引文献"}))])),[[B,v.value]])]),_:1}),r(A,{label:"相关著作",name:"related"},{default:u(()=>[N((a(),n("div",gt,[V.value.length?(a(!0),n(k,{key:0},y(V.value,t=>(a(),n("div",{class:"ref-item",key:t.workId},[r(g,{to:`/works/${t.workId}`,class:"ref-title"},{default:u(()=>[d(i(t.title),1)]),_:2},1032,["to"]),l("p",wt,i(t.authors)+" · "+i(t.journal)+" · "+i(T(t.publishTime)),1)]))),128)):(a(),w(x,{key:1,description:"暂无相关著作"}))])),[[B,v.value]])]),_:1})]),_:1},8,["modelValue"])])):c("",!0),s.value?(a(),n("div",bt,[l("h3",Ct,"评论 ("+i(O.value)+")",1),be(E).isLoggedIn?(a(),n("div",It,[r(ue,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=t=>I.value=t),type:"textarea",rows:3,placeholder:"发表您的评论..."},null,8,["modelValue"]),r($,{type:"primary",onClick:X,loading:z.value},{default:u(()=>[...e[11]||(e[11]=[d(" 发表评论 ",-1)])]),_:1},8,["loading"])])):(a(),n("div",Tt,[r(g,{to:"/login"},{default:u(()=>[...e[12]||(e[12]=[d("登录",-1)])]),_:1}),e[13]||(e[13]=d(" 后发表评论 ",-1))])),N((a(),n("div",Bt,[(a(!0),n(k,null,y(U.value,t=>(a(),n("div",{class:"comment-item",key:t.commentId},[r(ce,{size:40},{default:u(()=>{var L;return[d(i((L=t.userNickname)==null?void 0:L.charAt(0)),1)]}),_:2},1024),l("div",Lt,[l("div",Nt,[l("span",Et,i(t.userNickname),1),l("span",jt,i(T(t.commentTime)),1)]),l("p",Dt,i(t.content),1),l("div",Vt,[r($,{text:"",size:"small",onClick:L=>Z(t)},{default:u(()=>[r(h,null,{default:u(()=>[r(de)]),_:1}),d(" "+i(t.likes||0),1)]),_:2},1032,["onClick"]),r($,{text:"",size:"small"},{default:u(()=>[r(h,null,{default:u(()=>[r(_e)]),_:1}),d(" 回复 ("+i(t.replyCount||0)+") ",1)]),_:2},1024)])])]))),128)),U.value.length?c("",!0):(a(),w(x,{key:0,description:"暂无评论"}))])),[[B,R.value]])])):c("",!0)])),[[B,S.value]])}}},Jt=me($t,[["__scopeId","data-v-013805be"]]);export{Jt as default};
