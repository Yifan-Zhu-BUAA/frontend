import{_ as Q}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                 *//* empty css                   *//* empty css                  *//* empty css                  */import{r as i,O as W,o as X,b as c,d as n,C as P,x as V,g as o,w as a,i as Y,D as Z,v as U,F as L,B as M,t as u,a1 as ee,f as te,h as k,A as r,j as x,E as oe,a2 as le,a3 as ae,_ as se,N as ne,e as ie,P as re,R as ce,l as ue,U as g}from"./index-COpeM2_A.js";import{g as de,c as me,u as ve,d as pe,e as fe,r as _e}from"./collection-MFINAby5.js";const ye={class:"collections-page card"},ge={class:"page-header"},Ce={class:"favourites-list"},ke=["onClick"],Fe={class:"fav-info"},we={class:"fav-name"},he={class:"fav-count"},Ne={key:0,class:"collections-content"},Ee={class:"items-list"},Ve=["onClick"],xe={__name:"Collections",setup(Ie){const j=te(),F=i(!1),w=i(!1),h=i(!1),N=i([]),p=i(null),I=i(""),d=i([]),m=i(!1),f=i(null),s=W({fName:"",description:""}),E=async()=>{F.value=!0;try{const l=await de();N.value=l.data||[]}catch(l){console.error("获取收藏夹失败",l)}finally{F.value=!1}},R=async l=>{var e;p.value=l.fid,I.value=l.fName,w.value=!0;try{const _=await me(l.fid,{page:1,size:50});d.value=((e=_.data)==null?void 0:e.list)||[]}catch(_){console.error("获取收藏内容失败",_)}finally{w.value=!1}},A=l=>{f.value=l,s.fName=l.fName,s.description=l.description||"",m.value=!0},O=async()=>{if(!s.fName.trim()){g.warning("请输入收藏夹名称");return}h.value=!0;try{f.value?(await ve(f.value.fid,s),g.success("修改成功")):(await pe(s),g.success("创建成功")),m.value=!1,f.value=null,s.fName="",s.description="",E()}catch(l){console.error("保存失败",l)}finally{h.value=!1}},S=async l=>{try{await fe(l),g.success("删除成功"),p.value===l&&(p.value=null,d.value=[]),E()}catch(e){console.error("删除失败",e)}},T=async l=>{try{await _e(l),g.success("移除成功"),d.value=d.value.filter(e=>e.cid!==l)}catch(e){console.error("移除失败",e)}};return X(()=>{E()}),(l,e)=>{const _=k("Plus"),y=oe,v=Y,q=k("Folder"),G=k("Edit"),$=k("Delete"),H=ae,D=ne,b=ue,B=ce,J=re,K=ee,z=Z;return r(),c("div",ye,[n("div",ge,[e[7]||(e[7]=n("h2",{class:"page-title"},"我的收藏",-1)),o(v,{type:"primary",onClick:e[0]||(e[0]=t=>m.value=!0)},{default:a(()=>[o(y,null,{default:a(()=>[o(_)]),_:1}),e[6]||(e[6]=x("新建收藏夹 ",-1))]),_:1})]),P((r(),c("div",Ce,[(r(!0),c(L,null,M(N.value,t=>(r(),c("div",{class:le(["favourite-item",{active:p.value===t.fid}]),key:t.fid,onClick:C=>R(t)},[n("div",Fe,[o(y,null,{default:a(()=>[o(q)]),_:1}),n("span",we,u(t.fName),1),n("span",he,"("+u(t.count||0)+")",1)]),n("div",{class:"fav-actions",onClick:e[1]||(e[1]=se(()=>{},["stop"]))},[o(v,{text:"",size:"small",onClick:C=>A(t)},{default:a(()=>[o(y,null,{default:a(()=>[o(G)]),_:1})]),_:1},8,["onClick"]),o(H,{title:"确定删除该收藏夹吗？",onConfirm:C=>S(t.fid)},{reference:a(()=>[o(v,{text:"",size:"small",type:"danger"},{default:a(()=>[o(y,null,{default:a(()=>[o($)]),_:1})]),_:1})]),_:1},8,["onConfirm"])])],10,ke))),128)),N.value.length?V("",!0):(r(),U(D,{key:0,description:"暂无收藏夹"}))])),[[z,F.value]]),p.value?P((r(),c("div",Ne,[n("h3",null,u(I.value)+" 的内容",1),n("div",Ee,[(r(!0),c(L,null,M(d.value,t=>(r(),c("div",{class:"item-card",key:t.cid},[n("div",{class:"item-info",onClick:C=>ie(j).push(`/works/${t.achievementId}`)},[n("h4",null,u(t.title),1),n("p",null,u(t.authors)+" · "+u(t.journal)+" · "+u(t.date),1)],8,Ve),o(v,{text:"",type:"danger",onClick:C=>T(t.cid)},{default:a(()=>[o(y,null,{default:a(()=>[o($)]),_:1})]),_:1},8,["onClick"])]))),128)),d.value.length?V("",!0):(r(),U(D,{key:0,description:"该收藏夹为空"}))])])),[[z,w.value]]):V("",!0),o(K,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t),title:f.value?"编辑收藏夹":"新建收藏夹",width:"400px"},{footer:a(()=>[o(v,{onClick:e[4]||(e[4]=t=>m.value=!1)},{default:a(()=>[...e[8]||(e[8]=[x("取消",-1)])]),_:1}),o(v,{type:"primary",onClick:O,loading:h.value},{default:a(()=>[...e[9]||(e[9]=[x("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[o(J,{model:s,"label-width":"80px"},{default:a(()=>[o(B,{label:"名称"},{default:a(()=>[o(b,{modelValue:s.fName,"onUpdate:modelValue":e[2]||(e[2]=t=>s.fName=t),placeholder:"请输入收藏夹名称"},null,8,["modelValue"])]),_:1}),o(B,{label:"描述"},{default:a(()=>[o(b,{modelValue:s.description,"onUpdate:modelValue":e[3]||(e[3]=t=>s.description=t),type:"textarea",rows:3,placeholder:"可选描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ae=Q(xe,[["__scopeId","data-v-b0a09f0e"]]);export{Ae as default};
