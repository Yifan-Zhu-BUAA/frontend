import{_ as w}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                     *//* empty css                  *//* empty css                 *//* empty css                  */import{u as y,r as f,O as x,o as E,b as U,d as p,g as l,w as o,P as I,A,R,$ as B,q as C,j as c,t as P,l as S,i as F,a0 as N,U as h}from"./index-COpeM2_A.js";const q={class:"profile-page card"},D={__name:"Profile",setup(M){const m=y(),u=f(null),n=f(!1),e=x({nickname:"",email:"",avatar:"",fields:""}),_={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"昵称长度应在2-20个字符之间",trigger:"blur"}]},v=t=>{const a=new FileReader;a.onload=i=>{e.avatar=i.target.result},a.readAsDataURL(t.raw)},g=async()=>{await u.value.validate(async t=>{if(t){n.value=!0;try{await N({nickname:e.nickname,avatar:e.avatar,fields:e.fields}),m.updateUserInfo({nickname:e.nickname,avatar:e.avatar,fields:e.fields}),h.success("保存成功")}catch(a){console.error("保存失败",a)}finally{n.value=!1}}})};return E(()=>{const t=m.userInfo||{};e.nickname=t.nickname||"",e.email=t.email||"",e.avatar=t.avatar||"",e.fields=t.fields||""}),(t,a)=>{const i=C,k=B,r=R,d=S,V=F,b=I;return A(),U("div",q,[a[5]||(a[5]=p("h2",{class:"page-title"},"个人资料",-1)),l(b,{model:e,rules:_,ref_key:"formRef",ref:u,"label-width":"100px",class:"profile-form"},{default:o(()=>[l(r,{label:"头像"},{default:o(()=>[l(k,{class:"avatar-uploader",action:"#","show-file-list":!1,"auto-upload":!1,onChange:v},{default:o(()=>[l(i,{size:80,src:e.avatar},{default:o(()=>{var s;return[c(P((s=e.nickname)==null?void 0:s.charAt(0)),1)]}),_:1},8,["src"]),a[3]||(a[3]=p("div",{class:"upload-tip"},"点击更换头像",-1))]),_:1})]),_:1}),l(r,{label:"昵称",prop:"nickname"},{default:o(()=>[l(d,{modelValue:e.nickname,"onUpdate:modelValue":a[0]||(a[0]=s=>e.nickname=s),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(r,{label:"邮箱"},{default:o(()=>[l(d,{modelValue:e.email,"onUpdate:modelValue":a[1]||(a[1]=s=>e.email=s),disabled:""},null,8,["modelValue"])]),_:1}),l(r,{label:"研究领域",prop:"fields"},{default:o(()=>[l(d,{modelValue:e.fields,"onUpdate:modelValue":a[2]||(a[2]=s=>e.fields=s),type:"textarea",rows:3,placeholder:"多个领域用分号分隔"},null,8,["modelValue"])]),_:1}),l(r,null,{default:o(()=>[l(V,{type:"primary",onClick:g,loading:n.value},{default:o(()=>[...a[4]||(a[4]=[c("保存修改",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])}}},G=w(D,[["__scopeId","data-v-8c17095d"]]);export{G as default};
